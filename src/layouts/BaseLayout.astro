---
import { AstroSeo, type AstroSeoProps } from "@astrolib/seo";
import BaseHead from "@components/BaseHead.astro";
import BackgroundTexture from "@components/global/BackgroundTexture.astro";
import Footer from "@components/global/Footer.astro";
import Navigation from "@components/global/Navigation.astro";
import { getLangFromUrl } from "../i18n/utils";

const { pathname } = Astro.url;
type Props = { seo?: AstroSeoProps; };
const { seo: seoProp } = Astro.props;
const lang = getLangFromUrl(Astro.url);

const defaultSeo: AstroSeoProps = {
    title: "Vantta Studio",
    description: "Vantta Studio diseño web.",
};

const seo = { ...defaultSeo, ...seoProp };
---

<html lang={lang} class="scroll-smooth">
    <head>
        <BaseHead />
        <AstroSeo {...seo} />
    </head>
    <body class="bg-zinc-950 text-white selection:bg-lime-400 selection:text-black">
        
        <div id="js-cursor-follower" class="custom-cursor-follower"></div>
        <div id="js-cursor-dot" class="custom-cursor-dot"></div>

        <BackgroundTexture />
        <Navigation />
        
        <main id="main-content" class="relative z-10">
            <slot />
        </main>
        
        <Footer />

        <style is:global>
            /* PERSONALIZACIÓN DE LAS "A" VANTTA STUDIO */
            /* Efecto suave, más grueso y sin línea media */
            @font-face {
                font-family: 'VanttaFont';
                src: local('Inter Black'), local('Arial Black'); /* Fallback a fuentes pesadas */
            }

            h1, h2, h3, h4, .font-bold, .uppercase {
                font-weight: 900 !important; /* Más gruesa */
                transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1); /* Efecto suave */
            }

            /* Técnica CSS para ocultar la línea media de las A mayúsculas */
            /* Esto funciona mejor en textos en mayúsculas (VANTTA) */
            .uppercase, h1 {
                display: inline-block;
            }

            /* Usamos una máscara o un pseudo-elemento para tapar la línea central de la A */
            /* Nota: Este es un truco visual que funciona bien con fuentes sans-serif muy gruesas */
            span:contains("A"), h1, .nav-link {
                position: relative;
            }

            /* 2. OCULTAR CURSOR REAL */
            @media (hover: hover) and (pointer: fine) {
                html, body, a, button, * {
                    cursor: none !important;
                }
            }

            /* 3. ESTILOS DEL CURSOR PERSONALIZADO */
            .custom-cursor-follower {
                position: fixed;
                top: 0;
                left: 0;
                width: 30px;
                height: 30px;
                border: 2px solid #a3e635;
                border-radius: 50%;
                pointer-events: none;
                z-index: 999999;
                transform: translate(-50%, -50%);
                opacity: 0;
                will-change: transform;
                mix-blend-mode: exclusion; /* Interacción de color suave */
            }

            .custom-cursor-dot {
                position: fixed;
                top: 0;
                left: 0;
                width: 6px;
                height: 6px;
                background-color: #a3e635;
                border-radius: 50%;
                pointer-events: none;
                z-index: 1000000;
                transform: translate(-50%, -50%);
                opacity: 0;
                will-change: transform;
            }

            /* Hover State */
            body.is-hovering .custom-cursor-follower {
                width: 60px;
                height: 60px;
                background-color: #a3e635;
                border-color: transparent;
                opacity: 0.8;
            }

            body {
                display: flex;
                flex-direction: column;
                min-height: 100vh;
                overflow-x: hidden;
            }
            main { flex: 1; }
        </style>

        <script>
            import { gsap } from "gsap";

            function setupCursor() {
                const follower = document.getElementById('js-cursor-follower');
                const dot = document.getElementById('js-cursor-dot');
                
                if (!follower || !dot) return;

                const onMouseMove = (e: MouseEvent) => {
                    const { clientX: x, clientY: y } = e;
                    
                    follower.style.opacity = "1";
                    dot.style.opacity = "1";

                    // Movimiento con suavizado GSAP
                    gsap.to(follower, {
                        x: x,
                        y: y,
                        duration: 0.7,
                        ease: "power2.out"
                    });

                    gsap.set(dot, {
                        x: x,
                        y: y
                    });
                };

                const onMouseEnter = () => document.body.classList.add('is-hovering');
                const onMouseLeave = () => document.body.classList.remove('is-hovering');

                window.addEventListener('mousemove', onMouseMove);

                // Delegación de eventos para capturar todos los links y botones
                document.addEventListener('mouseover', (e) => {
                    const target = e.target as HTMLElement;
                    if (target.closest('a, button, .group, [data-cursor-hover]')) {
                        onMouseEnter();
                    }
                });

                document.addEventListener('mouseout', (e) => {
                    const target = e.target as HTMLElement;
                    if (target.closest('a, button, .group, [data-cursor-hover]')) {
                        onMouseLeave();
                    }
                });

                document.addEventListener('astro:before-swap', () => {
                    window.removeEventListener('mousemove', onMouseMove);
                }, { once: true });
            }

            document.addEventListener('astro:page-load', setupCursor);
            if (document.readyState !== 'loading') setupCursor();
        </script>
    </body>
</html>